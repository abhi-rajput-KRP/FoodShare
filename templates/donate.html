<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Food Donation</title>
    <link
      rel="icon"
      href="https://firebasestorage.googleapis.com/v0/b/food-donation-bc43b.firebasestorage.app/o/favicon.ico?alt=media&token=56a306dc-3749-4d56-962b-dcfbb59cce10"
      type="image/x-icon"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
    />

    <style>
      body {
        background-color: #f0f2f5;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .main-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }
      .form-check-group {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #e9ecef;
      }
      .section-title {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #6c757d;
        font-weight: 700;
        margin-bottom: 10px;
        display: block;
      }
      .btn-primary {
    color: #fff;
    background-color: #09e109;
    border-color: #7dd97f;
}
.text-primary {
    --bs-text-opacity: 1;
    color: rgb(11 183 66) !important;
}
    </style>
  </head>

  <body>
    <nav class="navbar navbar-light bg-white shadow-sm mb-4">
      <div class="container">
        <span class="navbar-brand mb-0 h1">
          <i class="bi bi-basket2-fill text-primary me-2"></i>FoodShare
        </span>
      </div>
      <a href="/logout" style="margin-left: 5px"
        ><button
          style="margin-top: 2px; width: 20%; align-self: flex-end"
          class="btn btn-primary w-100 rounded-pill shadow-sm"
        >
          Logout
        </button></a
      >
    </nav>

    <div class="container pb-5">
      <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
          <div class="card main-card">
            <div class="card-body p-4">
              <h4 class="card-title text-center mb-4">Post Food Donation</h4>

              <form id="postForm" enctype="multipart/form-data">
                <div class="mb-4">
                  <label for="photo" class="form-label fw-bold">
                    <i class="bi bi-camera me-1"></i> Upload Photo
                  </label>
                  <input
                    type="file"
                    class="form-control"
                    name="photo"
                    id="photo"
                    accept="image/*"
                  />
                </div>

                <div class="form-floating mb-4">
                  <textarea
                    class="form-control"
                    name="description"
                    id="description"
                    placeholder="Description"
                    style="height: 100px"
                  ></textarea>
                  <label for="description"
                    >Description (e.g., Leftover biryani)</label
                  >
                </div>

                <div class="mb-4">
                  <span class="section-title">Food Categories</span>
                  <div class="form-check-group">
                    <div class="row g-2">
                      <div class="col-6">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault"
                          />
                          <label class="form-check-label" for="checkDefault"
                            >Cooked rice dish</label
                          >
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault1"
                          />
                          <label class="form-check-label" for="checkDefault1"
                            >Dairy-based curries</label
                          >
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault2"
                          />
                          <label class="form-check-label" for="checkDefault2"
                            >Non-veg curries</label
                          >
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault3"
                          />
                          <label class="form-check-label" for="checkDefault3"
                            >Dal/lentils</label
                          >
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault4"
                          />
                          <label class="form-check-label" for="checkDefault4"
                            >Fresh breads</label
                          >
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault5"
                          />
                          <label class="form-check-label" for="checkDefault5"
                            >Gravy veg curries</label
                          >
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault6"
                          />
                          <label class="form-check-label" for="checkDefault6"
                            >Dry vegetable</label
                          >
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault7"
                          />
                          <label class="form-check-label" for="checkDefault7"
                            >Fried items</label
                          >
                        </div>
                      </div>
                      <div class="col-12">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            value=""
                            id="checkDefault8"
                          />
                          <label class="form-check-label" for="checkDefault8"
                            >Sweets</label
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-floating mb-4">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="number"
                        class="form-control"
                        name="quantity"
                        id="quantity"
                        placeholder="Quantity"
                        required
                      />
                      <label for="quantity"
                        ><i class="bi bi-box-seam me-1"></i>How many people can it serve ?</label
                      >
                      <input type="hidden" id="donor_lat" name="donor_lat">
                      <input type="hidden" id="donor_lng" name="donor_lng">

                    </div>
                  </div>
                </div>
                <div class="form-floating mb-4">
                  <input
                    type="datetime-local"
                    class="form-control"
                    id="prepared_at"
                    required
                  />
                  <label for="prepared_at">When was this prepared?</label>
                </div>

                <div class="card bg-light border-0 mb-4">
                  <div class="card-body">
                    <span class="section-title text-primary"
                      ><i class="bi bi-thermometer-half"></i> Storage
                      Conditions</span
                    >

                    <div class="form-check form-switch mb-3">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        role="switch"
                        id="fridgeSwitch"
                      />
                      <label class="form-check-label fw-bold" for="fridgeSwitch"
                        >Is food refrigerated?</label
                      >
                    </div>

                    <div class="input-group">
                      <span class="input-group-text bg-white"
                        ><i class="bi bi-thermometer-sun"></i
                      ></span>
                      <div class="form-floating flex-grow-1">
                        <input
                          type="number"
                          class="form-control"
                          name="temperature"
                          id="temperature"
                          placeholder="Temp"
                          disabled
                        />
                        <label for="temperature"
                          >Will be fetched as per your city</label
                        >
                      </div>
                    </div>
                    <small class="text-muted" id="tempHelp"></small>
                  </div>
                </div>

                <button
                  type="submit"
                  onclick="alert('Wait Until you get success message ...')"
                  class="btn btn-primary w-100 rounded-pill shadow-sm"
                >
                  <i class="bi bi-send-fill me-2"></i> Post Food
                </button>
              </form>
              <a href="/dashboard_donor"
                ><button
                  style="margin-top: 10px"
                  class="btn btn-primary w-100 rounded-pill shadow-sm"
                >
                  Go to Dashboard
                </button></a
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // --- Original Logic Preserved Below ---
      document
        .getElementById("postForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          // Collect form data FIRST
          const checkboxes = document.querySelectorAll(
            'input[type="checkbox"]:checked:not(#fridgeSwitch)'
          ); // Exclude switch
          const food_types = Array.from(checkboxes).map((cb) =>
            cb.nextElementSibling.textContent.trim()
          );
          const preparedStr = document.getElementById("prepared_at").value; // e.g. "2026-01-10T13:30"

          const fridgeSwitch = document.getElementById("fridgeSwitch").checked;

          // Temperature logic
          let temp;
          if (fridgeSwitch) {
            temp = 0; // Refrigerator temp
          } else {
            temp = await fetch("/temp")
              .then((res) => res.json())
              .then((data) => data.temp);
          }
          // const hrs = 2; // Fixed hours
          let food_type_num = food_types.length > 0 ? 1 : 0;
          try {
            const formData = new FormData();
            formData.append(
              "description",
              document.getElementById("description").value
            );
            formData.append(
              "quantity",
              document.getElementById("quantity").value
            );
            // formData.append("risk", risk);
            formData.append("temperature", temp);
            formData.append("is_refrigerated", fridgeSwitch); // Save fridge status
            formData.append("food_types", JSON.stringify(food_types));
            formData.append("prepared_at", preparedStr);
            // formData.append("prediction", prediction.prediction);
            if (document.getElementById("photo").files[0])
              formData.append(
                "photo",
                document.getElementById("photo").files[0]
              );
            // inside your existing submit handler, before fetch("/post", ...)
            formData.append("donor_lat", document.getElementById("donor_lat").value || "");
            formData.append("donor_lng", document.getElementById("donor_lng").value || "");

            const postRes = await fetch("/post", {
              method: "POST",
              body: formData,
            });
            if (postRes.ok) {
              alert("✅ Posted");
              document.getElementById("postForm").reset();
              document.getElementById("fridgeSwitch").checked = false; // Reset switch
              // Reset UI state for temperature
            } else {
              alert("❌ Post failed");
            }
          } catch (error) {
            alert("Error: " + error.message);
          }
        });
    </script>
    <script>
window.addEventListener('load', () => {
  navigator.geolocation.getCurrentPosition(
    pos => {
      const latInput = document.getElementById('donor_lat');
      const lngInput = document.getElementById('donor_lng');
      if (!latInput || !lngInput) {
        console.warn('Hidden inputs for donor_lat/donor_lng not found');
        return;
      }
      console.log('✅ Donor GPS:', pos.coords.latitude, pos.coords.longitude);
      latInput.value = pos.coords.latitude;
      lngInput.value = pos.coords.longitude;
    },
    err => {
      console.warn('⚠️ Donor GPS failed:', err.code, err.message);
      // OK: user denied, form will submit without coords
    },
    { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }
  );
});
</script>


  </body>
</html>
