<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Donor Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      href="https://firebasestorage.googleapis.com/v0/b/food-donation-bc43b.firebasestorage.app/o/favicon.ico?alt=media&token=56a306dc-3749-4d56-962b-dcfbb59cce10"
      type="image/x-icon"
    />
    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
      :root {
        --primary: #2ecc71;
        --primary-dark: #27ae60;
        --secondary: #34495e;
        --bg-color: #f4f6f8;
        --card-bg: #ffffff;
        --text-main: #2c3e50;
        --text-light: #7f8c8d;
        --accent: #e67e22;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        width: 100%;
      }

      body {
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        display: flex;
      }

      /* Header Styling */
      header {
        background-color: var(--card-bg);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      header h2 {
        margin: 0;
        color: var(--primary-dark);
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Sidebar */
      .sidebar {
        width: 260px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
        background-color: var(--card-bg);
        border-right: 1px solid #e0e0e0;
        z-index: 998;
      }

      .sidebar .nav-link {
        color: #5f6b7a;
        border-radius: 12px;
        padding: 0.5rem 0.75rem;
        font-weight: 500;
      }

      .sidebar .nav-link.active {
        background-color: #e6f8ed;
        color: var(--primary-dark);
      }

      /* Main Content */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }
      .menu_svg {
      display: none;
      position: absolute;
      top: 1rem;
      left: 1rem;
      cursor: pointer;
    }
      @media (max-width: 660px) {
        .sidebar {
          display: none;
          position: absolute;
          padding-top: 30px;
          z-index: 990;
        }
        .stat-card {
          width: 80vw;
        }
        .menu_svg {
          display: block;
          z-index: 999;
        }
        .material-icons-round {
          margin-left: 30px;
        }
      }
    </style>
  </head>
  <body>
    <svg
      id="menu-icon"
      class="menu_svg"
      xmlns="www.w3.org"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
    <!-- Sidebar on LEFT -->
    <aside class="sidebar">
      <div class="p-3 d-flex align-items-center">
        <div
          class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center me-2"
          style="width: 32px; height: 32px"
        >
          <i class="bi bi-heart-fill"></i>
        </div>
        <div>
          <h6 class="mb-0 fw-bold">FoodShare</h6>
          <small class="text-muted">Share the love</small>
        </div>
      </div>

      <div class="px-3 mb-3">
        <a href="/donate">
          <button class="btn btn-success w-100 fw-semibold">
            + Create Donation
          </button>
        </a>
      </div>

      <nav class="px-2">
        <p class="text-uppercase text-muted small mb-1">Main menu</p>
        <ul class="nav nav-pills flex-column mb-3">
          <li class="nav-item">
            <a class="nav-link" href="/dashboard_donor">
              <i class="bi bi-speedometer2 me-2"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/my_donations"
              ><i class="bi bi-gift me-2"></i>My Donations</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/ngos_nearby"
              ><i class="bi bi-map me-2"></i>NGOs Near me</a
            >
          </li>
        </ul>

        <p class="text-uppercase text-muted small mb-1">Account</p>
        <ul class="nav nav-pills flex-column mb-3">
          <li class="nav-item">
            <a class="nav-link" href="/profile_donor"
              ><i class="bi bi-person me-2"></i>Profile</a
            >
          </li>
        </ul>
      </nav>

      <div class="mt-auto p-3 border-top d-flex align-items-center">
        <div
          class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center me-2"
          style="width: 36px; height: 36px"
        >
          {{ donor.name[0] if donor.name else 'U' }}
        </div>
        <div>
          <div class="fw-semibold">{{ donor.name }}</div>
          <small class="badge bg-success-subtle text-success">Donor</small>
        </div>
      </div>
    </aside>

    <!-- Main Content on RIGHT -->
    <div class="main-content">
      <!-- Header -->
      <header>
        <h2>
          <span class="material-icons-round">volunteer_activism</span>
          FoodShare
        </h2>
        <a href="/logout">
          <button
            style="background-color: #27ae60"
            class="btn btn-primary rounded-pill shadow-sm"
          >
            Logout
          </button>
        </a>
      </header>
      <div style="margin-bottom: 0px; padding: 0 20px 40px">
        <h1 style="font-size: 1.8rem; color: var(--secondary)">
          NGOs Directory
        </h1>
        <p style="color: var(--text-light)">
          Find verified organizations accepting food donations
        </p>
      </div>
      <div class="container-fluid px-4 pb-4">
        <!-- MAP -->
        <div class="card shadow-sm mb-4">
          <div class="card-body p-0">
            <div
              id="map"
              style="height: 420px; width: 100%; border-radius: 12px"
            ></div>
          </div>
        </div>

        <!-- NGO DIRECTORY -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="fw-bold mb-0">NGOs Near You</h4>
          <span class="badge bg-success-subtle text-success">
            {{ ngos|length }} organizations found
          </span>
        </div>

        <div class="row" id="ngoCards">
          <!-- NGO cards will render here -->
        </div>
      </div>

      <script>
        const menuIcon = document.getElementById("menu-icon");
        const sidebar = document.querySelector(".sidebar");

        menuIcon.addEventListener("click", () => {
          if (sidebar.style.display === "block") {
            sidebar.style.display = "none";
          } else {
            sidebar.style.display = "block";
          }
        });
        const donorIcon = L.divIcon({
          html: `<i class="bi bi-person-raised-hand text-primary" style="font-size:32px;"></i>`,
          className: "leaflet-bootstrap-icon",
          iconSize: [32, 32],
          iconAnchor: [16, 32],
          popupAnchor: [0, -28],
        });

        const ngoIcon = L.divIcon({
          html: `<i class="bi bi-building-fill text-success" style="font-size:32px;"></i>`,
          className: "leaflet-bootstrap-icon",
          iconSize: [32, 32],
          iconAnchor: [16, 32],
          popupAnchor: [0, -28],
        });

        const donorLat = {{ donor.donor_lat }};
        const donorLng = {{ donor.donor_lng }};
        const ngos = {{ ngos | tojson }};

          // Initialize map
        const map = L.map("map").setView([donorLat, donorLng], 11);

          // Tile layer
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: "Â© OpenStreetMap"
        }).addTo(map);

          // Donor marker
        const donorMarker = L.marker([donorLat, donorLng], { icon: donorIcon })
          .addTo(map)
          .bindPopup("<b>You (Donor)</b>")
          .openPopup();


          // 30 km radius circle
        const radiusCircle = L.circle([donorLat, donorLng], {
            radius: 30000, // meters
            color: "orange",
            fillColor: "#ffec84",
            fillOpacity: 0.50
        }).addTo(map);

          // NGO markers
        ngos.forEach(ngo => {
          L.marker([ngo.ngo_lat, ngo.ngo_lng], { icon: ngoIcon })
            .addTo(map)
            .bindPopup(`
              <b>${ngo.name}</b><br>
              ${ngo.distance} km away<br><br>
              <a target="_blank"
                 href="https://www.google.com/maps/dir/?api=1&origin=${donorLat},${donorLng}&destination=${ngo.lat},${ngo.lng}">
                 Get Directions
              </a>
            `);
        });
        const ngoCardsContainer = document.getElementById("ngoCards");

        ngos.forEach((ngo) => {
          const col = document.createElement("div");
          col.className = "col-lg-4 col-md-6 mb-4";

          col.innerHTML = `
      <div class="card h-100 shadow-sm rounded-4">
        <div class="card-body">

          <div class="d-flex justify-content-between align-items-start mb-1">
            <h5 class="fw-semibold mb-0">${ngo.name}</h5>
            <span class="badge bg-success-subtle text-success">Verified</span>
          </div>

          <small class="text-muted d-block mb-2">
            <i class="bi bi-geo-alt"></i> ${ngo.distance} km away
          </small>

          <div class="small text-muted mb-1">
            <i class="bi bi-envelope me-1"></i>
            ${ngo.email || "Email not available"}
          </div>

          <div class="small text-muted mb-1">
            <i class="bi bi-telephone me-1"></i>
            ${ngo.phone || "Contact not available"}
          </div>

          <div class="small text-muted">
            <i class="bi bi-geo me-1"></i>
            ${ngo.location || "Location not available"}
          </div>

        </div>
      </div>
    `;

          ngoCardsContainer.appendChild(col);
        });
      </script>
    </div>
  </body>
</html>
